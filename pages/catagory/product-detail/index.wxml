<view class="container">

    <!-- <view class="top-bar y-font-xs">
        订单满200免运费
    </view> -->

    <view class="pro-box">
        <view class="pro-box-top y-padding-all">
            <view class="y-font-l y-font-blod">{{product.category}} {{product.product_name}} {{product.product_sn}}
            </view>
            <!-- <view class="y-color-red">初上市尺码范围: XS-XXL</view> -->

        </view>
        <view class="pro-box-middle">
            <swiper indicator-dots="{{true}}" autoplay="{{true}}" interval="3000" duration="500" class="swiper">
                <block wx:for="{{product.carousels}}" wx:key="index">
                    <swiper-item>
                        <van-image src="{{item.url}}" width="100%" height="100%" fit="fill"></van-image>
                    </swiper-item>
                </block>
            </swiper>
        </view>
        <view class="pro-box-bottom y-padding-all y-bgc-white y-line-height-200">
            <view class="tui-right y-font-s y-color-gray">
                初上市价格(吊牌价)：￥{{product.original_price}}
            </view>
            <van-divider custom-style="padding:0"/>

            <view class="inner-price-box ">
                <view class="y-font-xl y-color-red">
                    内购价:￥{{product.onsale_price}}
                </view>
                <view wx:for="{{product.inner_activities}}" wx:key="index">
                    {{item.title}}
                </view>
                <view>
                </view>
                <van-divider custom-style="padding:0"/>

            </view>

            <view class="vip-price-box ">
                <view class="y-font-xl y-color-red">
                    尊享价:￥{{product.vip_price}}
                </view>
                <view wx:for="{{product.vip_activities}}" wx:key="index">
                    {{item.title}}
                </view>
                <view>
                </view>
            </view>


            <!-- <view class="pro-box-bottom-line1 y-font-s y-color-gray tui-right">点击播放视频</view>
            <view class="pro-box-bottom-line2 tui-flex tui-align-between">
                <view class="y-font-xxl y-blod">￥199.00</view>
            </view>
            <view class="pro-box-bottom-line3  tui-right y-color-gray">支持30天无理由退款</view> -->

        </view>

    </view>
    <view class="select-box">
        <tui-list-cell arrow bindtap="onSelect">
            <text wx:if="{{checkedProduct.color&&checkedProduct.size}}">
                已选: {{checkedProduct.color}}  {{checkedProduct.size}}  数量: {{checkedProduct.num}}
            </text>
            <text wx:else>
                            请选择配送方式，颜色，尺码，数量
            </text>
        </tui-list-cell>
    </view>

    <van-tabs bind:change="onTabs" z-index="0">
        <van-tab title="我要还价">

            <van-collapse value="{{activeColl_bargain}}" bindchange="setDetail" data-prop="activeColl_bargain">
                <van-collapse-item title="{{collect_order.title}}" name="1">
                    <view>
                        <view wx:for="{{collect_order.rules}}" wx:key="index">
                            {{item.title}}
                        </view>
                        <view class="tui-right" bindtap="goTabBar" data-url="/pages/shopping/cart/index">
                            查看购物车
                        </view>
                    </view>
                </van-collapse-item>

                <van-collapse-item title="{{charge_discount.title}}" name="2">
                    <view>
                        <view wx:for="{{charge_discount.rules}}" wx:key="index">
                            {{item.title}}
                        </view>

                        <view class="tui-right" bindtap="go" data-url="/pages/shopping/cart/index">
                            查看活动详情
                        </view>

                    </view>
                </van-collapse-item>

                <van-collapse-item title="{{redeem.title}}" name="3">
                    <view>
                        <view wx:for="{{redeem.rules}}" wx:key="index">
                            {{item.title}}
                        </view>
                        <view class="tui-right" bindtap="go" data-url="/pages/shopping/cart/index">
                            查看积分规定
                        </view>
                    </view>
                </van-collapse-item>

                <van-collapse-item title="{{copon.title}}" name="4">
                    <view>
                        <view wx:for="{{copon.rules}}" wx:key="index">
                            {{item.title}}
                        </view>
                        <view class="tui-right" bindtap="go" data-url="/pages/shopping/cart/index">
                            查看我的优惠券
                        </view>
                    </view>
                </van-collapse-item>
            </van-collapse>

        </van-tab>
        <van-tab title="我要赚钱">
            <van-collapse value="{{activeColl_earn}}" bindchange="setDetail" data-prop="activeColl_earn">
                <van-collapse-item title="{{share.title}}" name="1">
                    <view>
                        <view wx:for="{{share.rules}}" wx:key="index">
                            {{item.title}}
                        </view>
                        <view class="tui-right" bindtap="go" data-url="/pages/shopping/cart/index">
                            分享给亲友
                        </view>
                    </view>
                </van-collapse-item>

                <van-collapse-item title="{{forward.title}}" name="2">
                    <view>
                        <view wx:for="{{forward.rules}}" wx:key="index">
                            {{item.title}}
                        </view>

                        <view class="tui-right" bindtap="go" data-url="/pages/shopping/cart/index">
                            转发公众号文章
                        </view>

                    </view>
                </van-collapse-item>

                <van-collapse-item title="{{push.title}}" name="3">
                    <view>
                        <view wx:for="{{push.rules}}" wx:key="index">
                            {{item.title}}
                        </view>
                        <view class="tui-right" bindtap="go" data-url="/pages/shopping/cart/index">
                            查看推手规则
                        </view>
                    </view>
                </van-collapse-item>

                <van-collapse-item title="{{groub_by.title}}" name="4">
                    <view>
                        <view wx:for="{{groub_by.rules}}" wx:key="index">
                            {{item.title}}
                        </view>
                        <view class="tui-right" bindtap="go" data-url="/pages/shopping/cart/index">
                            查看
                        </view>
                    </view>
                </van-collapse-item>
            </van-collapse>

        </van-tab>
    </van-tabs>

    <van-divider custom-style="padding:0"/>


    <!-- todo z-index为-1时，无法切换tap ，为0则有层级问题-->
    <van-tabs active="{{ 0 }}" bind:change="onTabs" z-index="0">
        <van-tab title="详情">
            <van-collapse value="{{activeColl}}" bindchange="setDetail" data-prop="activeColl">
                <van-collapse-item title="商品信息" name="1">
                    <view class=" pro-info-box y-color-black">
                        <view>
                            货号：427516000
                        </view>
                        <view>
                            <view class="y-font-blod">
                                上市季节
                            </view>
                            <view>
                                2020春季
                            </view>
                        </view>
                        <view>
                            <view class="y-font-blod">
                                材料成分
                            </view>
                            <view>
                                {{product.fabric}}
                            </view>
                        </view>

                        <view>
                            <view class="y-font-blod">
                                颜色
                            </view>
                            <text wx:for="{{product.colors}}" wx:key="index">
								{{item.name}}{{item.code}}
							</text>
                        </view>

                        <view>
                            <view class="y-font-blod">
                                尺码
                            </view>
                            <view>
                                {{product.fabric}}
                            </view>
                        </view>
                    </view>

                </van-collapse-item>
                <van-collapse-item title=" 商品说明" name="2">
                    <van-image src="{{product.explan}}" width="100%" fit="widthFix"></van-image>
                </van-collapse-item>

                <van-collapse-item title=" 搭配推荐" name="3" content-class="y-padding-none">
                    <view class="tui-center y-font-xxl  y-padding-all">搭配推荐</view>
                    <van-image src="https://www.uniqlo.cn/hmall/test/u0000000015484/model/rank1/first/591-822/1.jpg"
                               width="100%" fit="widthFix"></van-image>
                </van-collapse-item>

                <van-collapse-item title="商品细节" name="4" content-class="y-padding-none">
                    <view class="tui-center y-font-xxl  y-padding-all">商品细节</view>
                    <van-image wx:for="{{product.details}}" wx:key="index" src="{{item.url}}" width="100%"
                               fit="widthFix"></van-image>
                </van-collapse-item>

            </van-collapse>

        </van-tab>
        <van-tab title="咨询">

            <view class="y-padding-tb advisory-box">
                <tui-card class="y-padding-tb" title="{{advisory}}">
                    <view slot="body" class="y-padding-all">
                        <view class="">
                            <textarea class="textarea" name="desc" placeholder="请输入你要咨询的内容" auto-focus/>
                        </view>
                        <van-divider custom-style="padding:0"/>
                        <view class="tui-center">
                            <van-button type="danger" size="normal" plain round custom-style="width:70%;">发布
                            </van-button>
                        </view>
                    </view>
                </tui-card>


                <tui-card class="y-padding-tb" title="{{card}}" wx:for="{{3}}" wx:key="index">
                    <view slot="body" class="y-padding-all">
                        很有弹性
                    </view>
                    <view slot="footer" class="tui-flex tui-align-between y-padding-all">
                        <view>查看全部回答</view>
                        <view>2020-04-24 00:00</view>
                    </view>
                </tui-card>

            </view>

        </van-tab>
    </van-tabs>

    <van-divider contentPosition="center">到底了</van-divider>

    <!-- 弹出层 -->
    <van-popup show="{{ showPopup }}" position="bottom" closeable custom-style="height: 100%;"
               bind:close="onClosePopup">
        <view class="popup-box y-padding-all">

            <view class="popup-box-title y-padding-tb">
                {{product.category}} {{product.product_name}}{{product.code}}
            </view>
            <view class="popup-box-top tui-flex tui-align-between">
                <view class="tui-col-4 y-padding-r">
                    <van-image src="https://www.uniqlo.cn/hmall/test/u0000000016501/main/first/561/1.jpg" width="100%"
                               fit="widthFix">
                    </van-image>
                </view>
                <!-- todo  文本过长会允许横向滑动 -->
                <view class="tui-col-8">
                    <view class="y-font-xl y-color-red">内购价 ￥{{product.onsale_price}}</view>
                    <view class="y-padding-tb tui-flex">

                        <view>
                            已选:
                        </view>
                        <view>
                            <view>
                                {{checkedProduct.size}}
                            </view>
                            <view>
                                {{checkedProduct.color}}
                            </view>
                        </view>
                    </view>
                </view>
            </view>

            <van-divider/>

            <view class="popup-box-colors">

                <view class="y-font-blod ">
                    颜色: {{checkedProduct.color}}
                </view>
                <view class="tui-flex">
                    <view wx:for="{{colors}}" wx:key="index"
                          class="y-pt-20 y-pl-20 tui-flex-col  ">
                        <view class="color-box {{item.checked&&!item.disabled?'color-checked':''}}">
                            <view class="y-h-w-100 tui-flex tui-align-center tui-vertical-center  tui-center">
                                <image style="height: 55rpx;width: 55rpx;{{item.disabled?'opacity:0.2;':''}};"
                                       mode="scaleToFill"
                                       src=" {{item.color_thumbnail}}"
                                       data-item="{{item}}" data-index="{{index}}" bindtap="onColor"/>
                            </view>
                            <!--                            <view class="y-pt-20">-->
                            <!--                                {{item.name}}-->
                            <!--                            </view>-->
                        </view>
                    </view>
                </view>
                <view class=" tui-flex tui-align-right tui-vertical-center"
                      bindtap="go"
                      data-url="/pages/catagory/colors/index">
                    选色攻略
                    <van-icon slot="icon" name="coupon-o"/>
                </view>
            </view>
            <van-divider/>
            <view class="popup-box-sizes">
                <view class="y-font-blod">
                    尺码:{{checkedProduct.size}}
                </view>
                <view class="  tui-flex tui-flex-wrap">
                    <view class="tui-flex tui-flex-wrap     ">
                        <view class="sizes-button-box {{item.checked&&!item.disabled?'size-checked':''}}" wx:for="{{sizes}}"
                              wx:key="index">
                            <van-button size="small" type="default"
                                        custom-style="font-weight:bolder"
                                        disabled="{{item.disabled}}"
                                        color="{{item.checked?'#000':''}}"
                                        data-item="{{item}}" data-index="{{index}}"
                                        bindtap="onSize">
                                {{item.display_name}}
                            </van-button>
                        </view>
<!--                        color="{{item.disabled?'#000':''}}"-->
                        <!--                        <view class="sizes-button-box ">-->
                        <!--                            <van-button size="small" disabled custom-style="font-weight:bolder">禁用180/65A/M</van-button>-->
                        <!--                        </view>-->
                        <!--                        <view class="sizes-button-box size-checked">-->
                        <!--                            <van-button size="small" color="#000"-->
                        <!--                                        custom-style="font-weight:bolder;">选中180/65A/M-->
                        <!--                            </van-button>-->
                        <!--                        </view>-->
                        <!--                        <view class="sizes-button-box">-->
                        <!--                            <van-button size="small"-->
                        <!--                                        custom-style="font-weight:bolder;">正常180/65A/M-->
                        <!--                            </van-button>-->
                        <!--                        </view>-->

                    </view>
                </view>
                <view class=" tui-flex tui-align-right tui-vertical-center"
                      bindtap="go"
                      data-url="/pages/catagory/sizes/index">
                    选码须知
                    <van-icon slot="icon" name="coupon-o"/>
                </view>

            </view>
            <van-divider/>



            <view class="popup-box-num tui-flex tui-align-between">
                <view class="y-font-blod">购买数量</view>
                <view class="tui-flex tui-vertical-center">
                    <van-stepper button-size="48rpx" input-width="75rpx"
                                 value="{{ 1 }}" min="1" bind:change="onSetNum"/>
                </view>
            </view>

<!--            <view class="tui-flex tui-align-between y-padding-t">-->
            <view class="y-padding-t">
                <van-button  size="large" type="danger" bind:click="onConfirmCart"  >确定</van-button>

            </view>
<!--                <van-button type="danger" plain  >立即购买</van-button>-->

<!--            </view>-->
        </view>
    </van-popup>

    <!-- 底部栏 -->
    <van-goods-action custom-class="cus-goods-action" >
        <van-goods-action-icon icon="shop-o" text="店铺" bind:click='goTabBar' data-url="/pages/home/index/index"/>
        <van-goods-action-icon icon="chat-o" text="客服" bind:click="go"/>
        <van-goods-action-icon icon="cart-o" text="购物车" info="{{$state.cart.totalNum}}" bind:click="goTabBar" data-url="/pages/shopping/cart/index"/>
        <van-goods-action-button  color="#ff0101"   text="加入购物车" type="warning" bind:click="onAddCart">

        </van-goods-action-button>
        <van-goods-action-button  color="#fff" bind:click="onBuyNow">
            <view class="y-color-red">立即购买</view>
        </van-goods-action-button>

    </van-goods-action>
    <scroll-top scrollTop="{{scrollTop}}" text="TOP"></scroll-top>
    <share ></share>

</view>
